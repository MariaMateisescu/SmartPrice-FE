import{E as f,Q as S}from"./EmptyData.185ef044.js";import{_ as u,aS as l,o as a,c as p,ac as d,a5 as c,a4 as m,ce as v,bJ as w,bI as L,a as h,ab as D,N as E,T as x}from"./index.ce21302b.js";import{E as T}from"./EmptyState.23af5e41.js";import"./QDialog.4920ccab.js";import"./use-timeout.504eabbb.js";import"./ClosePopup.f0fe9fed.js";import"./QCard.8cf01adb.js";import"./QInput.f726d2e9.js";import"./uid.42677368.js";const C={name:"PieChart",computed:{series(){return this.categoryFreqSum?Object.values(this.categoryFreqSum):[]},chartOptions(){return this.categoryFreqSum?{chart:{width:380,type:"pie"},labels:Object.keys(this.categoryFreqSum),responsive:[{breakpoint:480,options:{chart:{width:"100%"},legend:{position:"bottom"}}}]}:null}},data(){return{categoryFreqSum:null}},async mounted(){const t=await this.$api.get("/shopping-lists/get-category-statistics");this.categoryFreqSum=t.data.data.compressedCategoryFreqSum}},b={key:0,id:"chart"};function k(t,s,i,o,e,n){const r=l("apexchart");return e.categoryFreqSum?(a(),p("div",b,[d(r,{type:"pie",width:"500",options:n.chartOptions,series:n.series},null,8,["options","series"])])):c("",!0)}var U=u(C,[["render",k],["__scopeId","data-v-32550940"]]);const B={name:"BarChart",props:["completedLists"],computed:{calculatedTimeSpent(){let t=[],s=0;return this.completedLists.forEach(i=>{s=i.timeEnded-i.timeStarted;let o=new Date(s).getUTCHours(),e=new Date(s).getUTCMinutes();new Date(s).getUTCSeconds()>30&&e++,t.push(o?o*60+e:e)}),t},calculatedDates(){let t=[];return this.completedLists.forEach(s=>{t.push(new Date(s.timeEnded).toLocaleDateString("fr-FR"))}),t},series(){return[{name:"Time spent",data:this.calculatedTimeSpent}]},chartOptions(){return{chart:{height:350,type:"bar"},colors:["#26a69a"],events:["mousemove","mouseout","click"],plotOptions:{bar:{borderRadius:2,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,formatter:function(t){return t>=60?`${Math.floor(t/60)}h `+t%60+"'":t+"'"},offsetY:-20,style:{fontSize:"12px",colors:["#26a69a"]}},xaxis:{range:8,categories:this.calculatedDates,position:"bottom",axisBorder:{show:!1},axisTicks:{show:!0},tickPlacement:"on",tickAmount:8,crosshairs:{fill:{type:"gradient",gradient:{colorFrom:"#D8E3F0",colorTo:"#BED1E6",stops:[0,100],opacityFrom:.4,opacityTo:.5}}},tooltip:{enabled:!1}},yaxis:{axisBorder:{show:!1},axisTicks:{show:!1},labels:{show:!1,formatter:function(t){return t>=60?`${Math.floor(t/60)}h `+t%60+"'":t+"'"}}},title:{text:"Time Spent Shopping",floating:!0,offsetY:330,align:"center",style:{color:"#444"}}}}}};function F(t,s,i,o,e,n){const r=l("apexchart");return a(),m(r,{type:"bar",class:"apex-chart-time",height:"300",width:"90%",options:n.chartOptions,series:n.series},null,8,["options","series"])}var q=u(B,[["render",F],["__scopeId","data-v-4c56bb34"]]);const O={name:"InsightsPage",components:{PieChart:U,BarChart:q,EmptyState:T,EmptyData:f},data(){return{image:"EmptyState.svg",title:"Ooops! You are not logged in!",message:"Log in to view your insights",imageEmptyData:"Void.svg",titleEmptyData:"Ooops! Nothing to show",messageEmptyData:"Complete lists view your insights",lists:[],completedLists:null,timeSpentArray:[],averageTime:null,$q:v()}},async mounted(){w().$patch({title:"Insights",showBackIcon:!1});try{this.userStore.authUser&&await this.fetchShoppingLists()}catch{this.$q.notify({type:"negative",position:"top",message:"Something went wrong!",color:"negative",timeout:"2500"})}},setup(){return{userStore:L()}},methods:{async fetchShoppingLists(){const t=await this.$api.get("/shopping-lists/get-shopping-lists");this.lists=t.data.shoppingLists,this.completedLists=this.lists.filter(r=>r.status==="completed");let s=0;this.completedLists.forEach(r=>s=s+(r.timeEnded-r.timeStarted));let i=s/this.completedLists.length,o=new Date(i).getUTCHours(),e=new Date(i).getUTCMinutes();new Date(i).getUTCSeconds()>30&&e++,this.averageTime=o?o+" hours ":""+e+" minutes"},calculateTimeSpentShopping(t){if(t.status==="completed"){const s=t.timeEnded-t.timeStarted;let i=new Date(s).getUTCHours(),o=new Date(s).getUTCMinutes();return new Date(s).getUTCSeconds()>30&&o++,i?i+" hours ":""+o+" minutes"}else return null}}},I={key:0,class:"row justify-center loading-spinner"},P={class:"insights-page"},H={key:0},N={class:"insights-page-title"},A={key:0,class:"text-h6"},M={key:1};function V(t,s,i,o,e,n){const r=l("BarChart"),g=l("PieChart"),_=l("EmptyState"),y=l("EmptyData");return a(),p(x,null,[!e.completedLists&&o.userStore.authUser?(a(),p("div",I,[d(S,{color:"cyan-9",size:"5em"})])):c("",!0),h("div",P,[o.userStore.authUser?(a(),p("div",H,[h("div",N,[e.completedLists?(a(),p("div",A," See your shopping behaviour ")):c("",!0),e.completedLists&&e.completedLists.length?(a(),p("div",M,[D(" Average time spent shopping: "),h("strong",null,E(e.averageTime),1)])):c("",!0)]),e.completedLists&&e.completedLists.length?(a(),m(r,{key:0,completedLists:e.completedLists},null,8,["completedLists"])):c("",!0),e.completedLists&&e.completedLists.length?(a(),m(g,{key:1})):c("",!0)])):(a(),m(_,{key:1,image:e.image,title:e.title,message:e.message},null,8,["image","title","message"]))]),o.userStore.authUser&&e.completedLists&&!e.completedLists.length?(a(),m(y,{key:1,image:e.imageEmptyData,title:e.titleEmptyData,message:e.messageEmptyData,style:{"margin-top":"-72px"}},null,8,["image","title","message"])):c("",!0)],64)}var X=u(O,[["render",V],["__scopeId","data-v-174842c3"]]);export{X as default};
