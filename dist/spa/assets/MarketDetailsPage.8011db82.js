import{_ as L,aS as h,o as c,c as p,ac as t,bd as n,a as l,N as u,bM as f,aO as b,aM as S,bK as v,ab as I,bf as w,T as x,aR as A,a4 as E,bJ as T,a5 as C}from"./index.53af7074.js";import{Q as _}from"./QInput.44e45490.js";import{Q as H,a as M}from"./QDialog.39da003e.js";import{Q as D,a as y}from"./QCard.eb5f99e8.js";import{C as V}from"./ClosePopup.40c42b20.js";import{Q as G,a as N}from"./QItemSection.eab1c608.js";import{Q}from"./QSlideItem.bb9418cb.js";import{Q as F}from"./QCardActions.4f9176d4.js";import"./use-timeout.9d8f708d.js";import"./uid.42677368.js";import"./TouchPan.7c5636ff.js";import"./selection.4991ade7.js";import"./use-cache.b0833c75.js";const U={data(){return{openedMarkerID:null,myCoordinates:{lat:0,lng:0},address:"",openingHours:"",zoom:14}},props:["locationInfo","marketLogo","marketName"],mounted(){this.myCoordinates.lat=this.locationInfo.coordinates.lat,this.myCoordinates.lng=this.locationInfo.coordinates.lng,this.address=this.locationInfo.address,this.openingHours=this.locationInfo.openingHours},computed:{icon(){return{url:this.marketLogo,scaledSize:{width:30,height:30},labelOrigin:{x:16,y:-10}}}},methods:{async markLocation(e){this.myCoordinates.lat=e.latLng.lat(),this.myCoordinates.lng=e.latLng.lng(),await this.getStreetAddressFrom(this.myCoordinates.lat,this.myCoordinates.lng)},openMarker(e){this.openedMarkerID=e},async getStreetAddressFrom(e,a){try{var{data:s}=await this.$axios.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+e+","+a+"&key=AIzaSyCaLqRmzlYh0hkEI_FtBx8nPhIS0jJH9V0");s.error_message?console.log(s.error_message):this.address=s.results[0].formatted_address}catch(k){console.log(k.message)}},async onSaveLocationChanges(){try{const e=this.address.split(",")[0],a={name:this.marketName+" "+e,address:this.address,openingHours:this.openingHours,coordinates:{lat:this.myCoordinates.lat,lng:this.myCoordinates.lng}};(await this.$api.patch(`/locations/${this.locationInfo._id}`,a)).data.status==="success"&&this.$emit("editLocationSuccess")}catch(e){console.log(e)}}}},P=e=>(b("data-v-2acc29be"),e=e(),S(),e),O=P(()=>l("div",{class:"coords-style"},null,-1));function j(e,a,s,k,o,i){const g=h("GMapInfoWindow"),m=h("GMapMarker"),r=h("GMapMap");return c(),p("div",null,[O,t(r,{center:o.myCoordinates,zoom:o.zoom,class:"map-style",onClick:i.markLocation},{default:n(()=>[t(m,{position:o.myCoordinates,icon:i.icon,clickable:!0,onClick:a[1]||(a[1]=d=>i.openMarker(s.locationInfo._id))},{default:n(()=>[t(g,{closeclick:!0,onCloseclick:a[0]||(a[0]=d=>i.openMarker(null)),opened:o.openedMarkerID===s.locationInfo._id},{default:n(()=>[l("div",null,u(o.address),1)]),_:1},8,["opened"])]),_:1},8,["position","icon"])]),_:1},8,["center","zoom","onClick"]),l("div",null,"Address: "+u(o.address),1),t(_,{modelValue:o.myCoordinates.lat,"onUpdate:modelValue":a[2]||(a[2]=d=>o.myCoordinates.lat=d),type:"text",label:"Latitude"},null,8,["modelValue"]),t(_,{modelValue:o.myCoordinates.lng,"onUpdate:modelValue":a[3]||(a[3]=d=>o.myCoordinates.lng=d),type:"text",label:"Longitude"},null,8,["modelValue"]),t(_,{modelValue:o.openingHours,"onUpdate:modelValue":a[4]||(a[4]=d=>o.openingHours=d),type:"text",label:"Opening Hours"},null,8,["modelValue"]),t(f,{style:{"background-color":"#00838f",color:"#fff"},onClick:i.onSaveLocationChanges,label:"Save Changes"},null,8,["onClick"])])}var q=L(U,[["render",j],["__scopeId","data-v-2acc29be"]]);const R={name:"LocationCard",props:["locationInfo","marketLogo","marketName"],components:{EditLocationDialog:q},emits:["fetchMarket"],data(){return{showEditLocation:!1,showDeleteLocation:!1}},beforeUnmount(){clearTimeout(this.timer)},methods:{finalize(e){this.timer=setTimeout(()=>{e()},1e3)},goToLocationDetailsPage(){this.$router.push(`/administration/markets/${this.$route.params.marketId}/${this.locationInfo._id}`)},showEditLocationDialog({reset:e}){this.showEditLocation=!0,this.finalize(e)},showDeleteLocationDialog({reset:e}){this.showDeleteLocation=!0,this.finalize(e)},async deleteLocation(){try{(await this.$api.delete(`/locations/${this.locationInfo._id}/${this.$route.params.marketId}`)).data.status==="success"&&(this.$emit("fetchMarket"),this.showDeleteLocation=!1)}catch(e){console.log(e)}},async editLocationSuccess(){this.showEditLocation=!1,this.$emit("fetchMarket")}}},J=e=>(b("data-v-a59a6b9c"),e=e(),S(),e),W={class:"row items-center"},Y={class:"row items-center"},K=J(()=>l("div",{class:"text-h6"},"Edit Location",-1)),X={class:"q-ml-sm"};function Z(e,a,s,k,o,i){const g=h("EditLocationDialog");return c(),p(x,null,[t(Q,{onLeft:i.showEditLocationDialog,onRight:i.showDeleteLocationDialog,onClick:i.goToLocationDetailsPage},{left:n(()=>[l("div",W,[t(v,{left:"",name:"edit"}),I(" Edit")])]),right:n(()=>[l("div",Y,[I("Delete "),t(v,{right:"",name:"delete"})])]),default:n(()=>[t(G,null,{default:n(()=>[t(N,null,{default:n(()=>[l("div",null,u(s.locationInfo.name),1),l("div",null,"Adresa: "+u(s.locationInfo.address),1),l("div",null,"Program: "+u(s.locationInfo.openingHours),1)]),_:1})]),_:1})]),_:1},8,["onLeft","onRight","onClick"]),t(M,{maximized:"",modelValue:o.showEditLocation,"onUpdate:modelValue":a[0]||(a[0]=m=>o.showEditLocation=m)},{default:n(()=>[t(D,null,{default:n(()=>[t(y,{class:"row items-center q-pb-none"},{default:n(()=>[K,t(H),w(t(f,{icon:"close",flat:"",round:"",dense:""},null,512),[[V]])]),_:1}),t(y,null,{default:n(()=>[t(g,{onEditLocationSuccess:i.editLocationSuccess,locationInfo:s.locationInfo,marketLogo:s.marketLogo,marketName:s.marketName},null,8,["onEditLocationSuccess","locationInfo","marketLogo","marketName"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:o.showDeleteLocation,"onUpdate:modelValue":a[1]||(a[1]=m=>o.showDeleteLocation=m),persistent:""},{default:n(()=>[t(D,null,{default:n(()=>[t(y,{class:"row items-center"},{default:n(()=>[l("span",X,"Are you sure you want to delete "+u(s.locationInfo.name)+"?",1)]),_:1}),t(F,{align:"right"},{default:n(()=>[w(t(f,{flat:"",label:"Cancel",color:"primary"},null,512),[[V]]),t(f,{flat:"",label:"Delete",color:"red",onClick:i.deleteLocation},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var $=L(R,[["render",Z],["__scopeId","data-v-a59a6b9c"]]);const ee={data(){return{openedMarkerID:null,myCoordinates:{lat:0,lng:0},zoom:10}},props:["market","locationsToBeDisplayed"],computed:{icon(){return{url:this.market.logo,scaledSize:{width:30,height:30},labelOrigin:{x:16,y:-10}}}},created(){navigator.geolocation.getCurrentPosition(e=>{this.myCoordinates.lat=e.coords.latitude,this.myCoordinates.lng=e.coords.longitude},e=>{console.log(e)})},methods:{markLocation(e){this.$emit("emitCoords",e.latLng)},openMarker(e){this.openedMarkerID=e}}};function oe(e,a,s,k,o,i){const g=h("GMapInfoWindow"),m=h("GMapMarker"),r=h("GMapMap");return c(),p("div",null,[t(r,{center:o.myCoordinates,zoom:o.zoom,class:"map-style",onClick:i.markLocation},{default:n(()=>[(c(!0),p(x,null,A(s.locationsToBeDisplayed,(d,z)=>(c(),E(m,{key:z,position:d.coordinates,icon:i.icon,clickable:!0,onClick:B=>i.openMarker(d._id)},{default:n(()=>[t(g,{closeclick:!0,onCloseclick:a[0]||(a[0]=B=>i.openMarker(null)),opened:o.openedMarkerID===d._id},{default:n(()=>[l("div",null,u(d.address),1)]),_:2},1032,["opened"])]),_:2},1032,["position","icon","onClick"]))),128))]),_:1},8,["center","zoom","onClick"])])}var te=L(ee,[["render",oe],["__scopeId","data-v-35e79f8c"]]);const ae={name:"MarketDetailPage",async mounted(){await this.fetchMarket(),T().$patch({title:this.market.name,showBackIcon:!0})},components:{LocationCard:$,AddLocationMapGoogle:te},data(){return{market:null,showAddLocation:!1,lat:null,lng:null,address:null,locationsLength:0,openingHours:"",locationsToBeDisplayed:[],search:""}},computed:{filteredLocations(){return this.market.locations.filter(e=>e.address.toLowerCase().indexOf(this.search)>-1)}},methods:{async saveLocation(){try{const e=this.address.split(",")[0],a={name:this.market.name+" "+e,address:this.address,openingHours:this.openingHours,coordinates:{lat:this.lat,lng:this.lng},productsList:[],marketId:this.$route.params.marketId,coordinatesGeoJSON:{coordinates:[this.lat,this.lng]}};(await this.$api.post("/locations",a)).data.status==="success"&&(await this.fetchMarket(),this.showAddLocation=!1,this.resetFields())}catch(e){console.log(e)}},async fetchMarket(){const e=await this.$api.get(`/markets/${this.$route.params.marketId}`);this.market=Object.assign(e.data.data.market),this.locationsToBeDisplayed=Object.assign(this.locationsToBeDisplayed,this.market.locations),this.locationsLength=this.market.locations.length},resetFields(){this.lat=null,this.lng=null,this.address="",this.openingHours=""},async onEmitCoords(e){this.lat=e.lat(),this.lng=e.lng(),await this.getStreetAddressFrom(this.lat,this.lng),this.locationsToBeDisplayed.length-this.locationsLength>=1?(this.locationsToBeDisplayed.splice(-1),this.locationsToBeDisplayed.push({_id:Date.now(),address:this.address,coordinates:{lat:this.lat,lng:this.lng}})):this.locationsToBeDisplayed.push({_id:Date.now(),address:this.address,coordinates:{lat:this.lat,lng:this.lng}})},async getStreetAddressFrom(e,a){try{let s=await this.$axios.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+e+","+a+"&key=AIzaSyCaLqRmzlYh0hkEI_FtBx8nPhIS0jJH9V0");s.data.error_message?console.log(s.data.error_message):this.address=s.data.results[0].formatted_address}catch(s){console.log(s.message)}}}},se=e=>(b("data-v-122b90fc"),e=e(),S(),e),ne={key:0},ie={class:"style"},le=["src"],re={class:"location-header"},de={key:0},ce={class:"location-card__list"},me={key:1},ue=se(()=>l("div",{class:"text-h6"},"Add Location",-1)),he={style:{"font-size":"18px"}},pe={class:"save-location__container"};function ge(e,a,s,k,o,i){const g=h("LocationCard"),m=h("AddLocationMapGoogle");return o.market?(c(),p("div",ne,[l("div",ie,[l("img",{class:"logo",src:o.market.logo,alt:"Market Logo"},null,8,le),l("div",re,u(o.market.name),1)]),t(f,{class:"add-location__btn",onClick:a[0]||(a[0]=r=>o.showAddLocation=!0)},{default:n(()=>[I("Add Location")]),_:1}),t(_,{modelValue:o.search,"onUpdate:modelValue":a[1]||(a[1]=r=>o.search=r),filled:"",type:"search",hint:"Search"},{append:n(()=>[t(v,{name:"search"})]),_:1},8,["modelValue"]),i.filteredLocations.length?(c(),p("div",de,[l("div",ce,[(c(!0),p(x,null,A(i.filteredLocations,r=>(c(),E(g,{key:r._id,locationInfo:r,marketLogo:o.market.logo,marketName:o.market.name,onFetchMarket:i.fetchMarket},null,8,["locationInfo","marketLogo","marketName","onFetchMarket"]))),128))])])):C("",!0),i.filteredLocations.length?C("",!0):(c(),p("div",me,"No locations to show.")),t(M,{maximized:"",modelValue:o.showAddLocation,"onUpdate:modelValue":a[5]||(a[5]=r=>o.showAddLocation=r)},{default:n(()=>[t(D,null,{default:n(()=>[t(y,{class:"row items-center q-pb-none"},{default:n(()=>[ue,t(H),w(t(f,{icon:"close",flat:"",round:"",dense:""},null,512),[[V]])]),_:1}),t(y,null,{default:n(()=>[t(m,{onEmitCoords:i.onEmitCoords,market:o.market,locationsToBeDisplayed:o.locationsToBeDisplayed},null,8,["onEmitCoords","market","locationsToBeDisplayed"]),l("div",he,"Address: "+u(o.address),1),t(_,{modelValue:o.lat,"onUpdate:modelValue":a[2]||(a[2]=r=>o.lat=r),type:"text",label:"Latitude"},null,8,["modelValue"]),t(_,{modelValue:o.lng,"onUpdate:modelValue":a[3]||(a[3]=r=>o.lng=r),type:"text",label:"Longitude"},null,8,["modelValue"]),t(_,{modelValue:o.openingHours,"onUpdate:modelValue":a[4]||(a[4]=r=>o.openingHours=r),type:"text",label:"Opening Hours"},null,8,["modelValue"]),l("div",pe,[t(f,{style:{"background-color":"#00838f",color:"#fff"},onClick:i.saveLocation,label:"Save Location"},null,8,["onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):C("",!0)}var Se=L(ae,[["render",ge],["__scopeId","data-v-122b90fc"]]);export{Se as default};
