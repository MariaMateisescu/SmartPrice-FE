import{y as H,a3 as p,am as J,cn as ve,bS as re,bX as _e,ap as M,bB as se,c5 as be,bT as ye,at as ee,bE as V,bF as Fe,bP as Me,bN as Ce,_ as ie,o as T,c as oe,ac as n,bd as o,a as y,bK as j,ab as I,bL as xe,N as te,bf as K,bM as C,T as ue,aO as de,aM as ce,bJ as Ve,aS as we,a4 as ae,aR as Se}from"./index.ce21302b.js";import{Q as me,a as W}from"./QDialog.4920ccab.js";import{u as De,d as Ie,Q as X,a as N}from"./QCard.8cf01adb.js";import{u as Ne,a as Qe,c as ze,e as Ae,b as Pe,f as le,Q as fe}from"./QInput.f726d2e9.js";import{Q as Le}from"./QChip.37d937ca.js";import{h as Ee}from"./format.2a3572e1.js";import{C as Y}from"./ClosePopup.f0fe9fed.js";import{Q as qe,a as ne}from"./QItemSection.63a16ed4.js";import{Q as Te}from"./QSlideItem.ff025550.js";import{Q as je}from"./QCardActions.86b6c055.js";import"./use-timeout.504eabbb.js";import"./uid.42677368.js";import"./TouchPan.659e6d41.js";import"./selection.97f373c5.js";import"./use-cache.b0833c75.js";function w(e,l,g,f){const a=[];return e.forEach(s=>{f(s)===!0?a.push(s):l.push({failedPropValidation:g,file:s})}),a}function q(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),re(e)}const Ue={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Be=["rejected"];function Oe({editable:e,dnd:l,getFileInput:g,addFilesToQueue:f}){const{props:a,emit:s,proxy:m}=J(),d=H(null),x=p(()=>a.accept!==void 0?a.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),Q=p(()=>parseInt(a.maxFiles,10)),z=p(()=>parseInt(a.maxTotalSize,10));function A(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&ve(t);else{const _=g();_&&_!==t.target&&_.click(t)}}function P(t){e.value&&t&&f(null,t)}function U(t,_,S,D){let i=Array.from(_||t.target.files);const v=[],F=()=>{v.length!==0&&s("rejected",v)};if(a.accept!==void 0&&x.value.indexOf("*/")===-1&&(i=w(i,v,"accept",u=>x.value.some(h=>u.type.toUpperCase().startsWith(h)||u.name.toUpperCase().endsWith(h))),i.length===0))return F();if(a.maxFileSize!==void 0){const u=parseInt(a.maxFileSize,10);if(i=w(i,v,"max-file-size",h=>h.size<=u),i.length===0)return F()}if(a.multiple!==!0&&i.length!==0&&(i=[i[0]]),i.forEach(u=>{u.__key=u.webkitRelativePath+u.lastModified+u.name+u.size}),D===!0){const u=S.map(h=>h.__key);i=w(i,v,"duplicate",h=>u.includes(h.__key)===!1)}if(i.length===0)return F();if(a.maxTotalSize!==void 0){let u=D===!0?S.reduce((h,R)=>h+R.size,0):0;if(i=w(i,v,"max-total-size",h=>(u+=h.size,u<=z.value)),i.length===0)return F()}if(typeof a.filter=="function"){const u=a.filter(i);i=w(i,v,"filter",h=>u.includes(h))}if(a.maxFiles!==void 0){let u=D===!0?S.length:0;if(i=w(i,v,"max-files",()=>(u++,u<=Q.value)),i.length===0)return F()}if(F(),i.length!==0)return i}function B(t){q(t),l.value!==!0&&(l.value=!0)}function c(t){re(t),(t.relatedTarget!==null||_e.is.safari!==!0?t.relatedTarget!==d.value:document.elementsFromPoint(t.clientX,t.clientY).includes(d.value)===!1)===!0&&(l.value=!1)}function L(t){q(t);const _=t.dataTransfer.files;_.length!==0&&f(null,_),l.value=!1}function O(t){if(l.value===!0)return M("div",{ref:d,class:`q-${t}__dnd absolute-full`,onDragenter:q,onDragover:q,onDragleave:c,onDrop:L})}return Object.assign(m,{pickFiles:A,addFiles:P}),{pickFiles:A,addFiles:P,onDragover:B,onDragleave:c,processFiles:U,getDndNode:O,maxFilesNumber:Q,maxTotalSizeNumber:z}}var he=se({name:"QFile",inheritAttrs:!1,props:{...Ne,...De,...Ue,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Qe,...Be],setup(e,{slots:l,emit:g,attrs:f}){const{proxy:a}=J(),s=ze(),m=H(null),d=H(!1),x=Ie(e),{pickFiles:Q,onDragover:z,onDragleave:A,processFiles:P,getDndNode:U}=Oe({editable:s.editable,dnd:d,getFileInput:G,addFilesToQueue:Z}),B=Ae(e),c=p(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),L=p(()=>le(c.value)),O=p(()=>c.value.map(r=>r.name).join(", ")),t=p(()=>Ee(c.value.reduce((r,k)=>r+k.size,0))),_=p(()=>({totalSize:t.value,filesNumber:c.value.length,maxFiles:e.maxFiles})),S=p(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:x.value,...f,id:s.targetUid.value,disabled:s.editable.value!==!0})),D=p(()=>"q-file q-field--auto-height"+(d.value===!0?" q-file--dnd":"")),i=p(()=>e.multiple===!0&&e.append===!0);function v(r){const k=c.value.slice();k.splice(r,1),u(k)}function F(r){const k=c.value.indexOf(r);k>-1&&v(k)}function u(r){g("update:modelValue",e.multiple===!0?r:r[0])}function h(r){r.keyCode===13&&ye(r)}function R(r){(r.keyCode===13||r.keyCode===32)&&Q(r)}function G(){return m.value}function Z(r,k){const b=P(r,k,c.value,i.value),$=G();$!=null&&($.value=""),b!==void 0&&((e.multiple===!0?e.modelValue&&b.every(ke=>c.value.includes(ke)):e.modelValue===b[0])||u(i.value===!0?c.value.concat(b):b))}function E(){return[M("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function pe(){if(l.file!==void 0)return c.value.length===0?E():c.value.map((k,b)=>l.file({index:b,file:k,ref:this}));if(l.selected!==void 0)return c.value.length===0?E():l.selected({files:c.value,ref:this});if(e.useChips===!0)return c.value.length===0?E():c.value.map((k,b)=>M(Le,{key:"file-"+b,removable:s.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{v(b)}},()=>M("span",{class:"ellipsis",textContent:k.name})));const r=e.displayValue!==void 0?e.displayValue:O.value;return r.length!==0?[M("div",{class:e.inputClass,style:e.inputStyle,textContent:r})]:E()}function ge(){const r={ref:m,...S.value,...B.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:Z};return e.multiple===!0&&(r.multiple=!0),M("input",r)}return Object.assign(s,{fieldClass:D,emitValue:u,hasValue:L,inputRef:m,innerValue:c,floatingLabel:p(()=>L.value===!0||le(e.displayValue)),computedCounter:p(()=>{if(e.counterLabel!==void 0)return e.counterLabel(_.value);const r=e.maxFiles;return`${c.value.length}${r!==void 0?" / "+r:""} (${t.value})`}),getControlChild:()=>U("file"),getControl:()=>{const r={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return s.editable.value===!0&&Object.assign(r,{onDragover:z,onDragleave:A,onKeydown:h,onKeyup:R}),M("div",r,[ge()].concat(pe()))}}),Object.assign(a,{removeAtIndex:v,removeFile:F,getNativeElement:()=>m.value}),be(a,"nativeEl",()=>m.value),Pe(s)}}),Re=se({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:l}){const{proxy:{$q:g}}=J(),f=ee(Fe,V);if(f===V)return console.error("QPage needs to be a deep child of QLayout"),V;if(ee(Me,V)===V)return console.error("QPage needs to be child of QPageContainer"),V;const s=p(()=>{const d=(f.header.space===!0?f.header.size:0)+(f.footer.space===!0?f.footer.size:0);if(typeof e.styleFn=="function"){const x=f.isContainer.value===!0?f.containerHeight.value:g.screen.height;return e.styleFn(d,x)}return{minHeight:f.isContainer.value===!0?f.containerHeight.value-d+"px":g.screen.height===0?d!==0?`calc(100vh - ${d}px)`:"100vh":g.screen.height-d+"px"}}),m=p(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>M("main",{class:m.value,style:s.value},Ce(l.default))}});const $e={name:"MarketCard",props:["marketInfo"],data(){return{showEditMarket:!1,showDeleteMarket:!1,marketName:null,marketLogo:null,timer:null}},emits:["fetchMarkets"],mounted(){this.marketName=this.marketInfo.name},beforeUnmount(){clearTimeout(this.timer)},methods:{finalize(e){this.timer=setTimeout(()=>{e()},1e3)},goToMarketDetailsPage(){this.$router.push(`/administration/markets/${this.marketInfo._id}`)},showEditMarketDialog({reset:e}){this.showEditMarket=!0,this.finalize(e)},async editMarket(){try{let e=new FormData;e.append("name",this.marketName),e.append("logo",this.marketLogo),(await this.$api.patch(`/markets/${this.marketInfo._id}`,e)).data.status==="success"&&(this.$emit("fetchMarkets"),this.showEditMarket=!1)}catch(e){console.log(e)}},showDeleteMarketDialog({reset:e}){this.showDeleteMarket=!0,this.finalize(e)},async deleteMarket(){try{(await this.$api.delete(`/markets/${this.marketInfo._id}`)).data.status==="success"&&(this.$emit("fetchMarkets"),this.showDeleteMarket=!1)}catch(e){console.log(e)}},uploadFile(){console.log(this.marketLogo)}}},He=e=>(de("data-v-0df4b602"),e=e(),ce(),e),Ke={class:"row items-center"},We={class:"row items-center"},Xe=["src"],Ye={class:"market-card__name"},Je=He(()=>y("div",{class:"text-h6"},"Edit Market",-1)),Ge={class:"q-ml-sm"};function Ze(e,l,g,f,a,s){return T(),oe(ue,null,[n(Te,{onLeft:s.showEditMarketDialog,onRight:s.showDeleteMarketDialog,onClick:s.goToMarketDetailsPage},{left:o(()=>[y("div",Ke,[n(j,{left:"",name:"edit"}),I(" Edit")])]),right:o(()=>[y("div",We,[I("Delete "),n(j,{right:"",name:"delete"})])]),default:o(()=>[n(qe,null,{default:o(()=>[n(ne,{avatar:""},{default:o(()=>[n(xe,{rounded:""},{default:o(()=>[y("img",{src:g.marketInfo.logo},null,8,Xe)]),_:1})]),_:1}),n(ne,null,{default:o(()=>[y("div",Ye,te(g.marketInfo.name),1)]),_:1})]),_:1})]),_:1},8,["onLeft","onRight","onClick"]),n(W,{maximized:"",modelValue:a.showEditMarket,"onUpdate:modelValue":l[2]||(l[2]=m=>a.showEditMarket=m)},{default:o(()=>[n(X,null,{default:o(()=>[n(N,{class:"row items-center q-pb-none"},{default:o(()=>[Je,n(me),K(n(C,{icon:"close",flat:"",round:"",dense:""},null,512),[[Y]])]),_:1}),n(N,null,{default:o(()=>[n(fe,{modelValue:a.marketName,"onUpdate:modelValue":l[0]||(l[0]=m=>a.marketName=m),type:"text",label:"Market Name",class:"q-mb-lg"},null,8,["modelValue"]),n(he,{color:"cyan-9",filled:"",modelValue:a.marketLogo,"onUpdate:modelValue":[l[1]||(l[1]=m=>a.marketLogo=m),s.uploadFile],label:"Logo"},{prepend:o(()=>[n(j,{name:"cloud_upload"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),n(C,{style:{color:"#00838f"},onClick:s.editMarket},{default:o(()=>[I("Edit market")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue"]),n(W,{modelValue:a.showDeleteMarket,"onUpdate:modelValue":l[3]||(l[3]=m=>a.showDeleteMarket=m),persistent:""},{default:o(()=>[n(X,null,{default:o(()=>[n(N,{class:"row items-center"},{default:o(()=>[y("span",Ge,"Are you sure you want to delete "+te(g.marketInfo.name)+"?",1)]),_:1}),n(je,{align:"right"},{default:o(()=>[K(n(C,{flat:"",label:"Cancel",color:"primary"},null,512),[[Y]]),n(C,{flat:"",label:"Delete",color:"red",onClick:s.deleteMarket},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var et=ie($e,[["render",Ze],["__scopeId","data-v-0df4b602"]]);const tt={name:"AdministrationPage",components:{MarketCard:et},async mounted(){Ve().$patch({title:"Markets",showBackIcon:!0}),await this.fetchMarkets()},data(){return{markets:[],showAddMarket:!1,marketLogo:null,marketName:""}},methods:{uploadFile(){console.log(this.marketLogo)},async fetchMarkets(){const e=await this.$api.get("/markets");this.markets=e.data.data.markets},resetFields(){this.marketLogo=null,this.marketName=""},async addMarket(){try{let e=new FormData;e.append("name",this.marketName),e.append("logo",this.marketLogo),(await this.$api.post("/markets",e)).data.status==="success"&&(await this.fetchMarkets(),this.showAddMarket=!1,this.resetFields())}catch(e){console.log(e)}}}},at=e=>(de("data-v-3bc03c10"),e=e(),ce(),e),lt={class:"page-style"},nt={class:"market-card__list"},rt=at(()=>y("div",{class:"text-h6"},"Add Market",-1)),st={class:"add-market__container"};function it(e,l,g,f,a,s){const m=we("MarketCard");return T(),ae(Re,null,{default:o(()=>[y("div",lt,[n(C,{class:"add-market__btn",onClick:l[0]||(l[0]=d=>a.showAddMarket=!0)},{default:o(()=>[I("Add Market")]),_:1}),y("div",nt,[(T(!0),oe(ue,null,Se(a.markets,d=>(T(),ae(m,{key:d._id,marketInfo:d,onFetchMarkets:s.fetchMarkets},null,8,["marketInfo","onFetchMarkets"]))),128))])]),n(W,{maximized:"",modelValue:a.showAddMarket,"onUpdate:modelValue":l[3]||(l[3]=d=>a.showAddMarket=d)},{default:o(()=>[n(X,null,{default:o(()=>[n(N,{class:"row items-center q-pb-none"},{default:o(()=>[rt,n(me),K(n(C,{icon:"close",flat:"",round:"",dense:""},null,512),[[Y]])]),_:1}),n(N,null,{default:o(()=>[n(fe,{modelValue:a.marketName,"onUpdate:modelValue":l[1]||(l[1]=d=>a.marketName=d),type:"text",label:"Market Name",class:"q-mb-lg"},null,8,["modelValue"]),n(he,{color:"cyan-9",filled:"",modelValue:a.marketLogo,"onUpdate:modelValue":[l[2]||(l[2]=d=>a.marketLogo=d),s.uploadFile],label:"Logo"},{prepend:o(()=>[n(j,{name:"cloud_upload"})]),_:1},8,["modelValue","onUpdate:modelValue"]),y("div",st,[n(C,{class:"add-market__btn q-mt-lg",onClick:s.addMarket},{default:o(()=>[I("Add market")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Mt=ie(tt,[["render",it],["__scopeId","data-v-3bc03c10"]]);export{Mt as default};
