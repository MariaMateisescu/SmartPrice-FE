import{a as F,Q as V,b as P}from"./QTabPanels.848a83f5.js";import{Q as K}from"./QTabs.c5391726.js";import{Q as S}from"./QSeparator.bd72d163.js";import{at as U,bE as x,bF as q,a3 as f,bN as H,ap as T,am as j,bB as z,_ as G,bJ as A,aS as J,o,c as g,a4 as c,bd as l,a5 as d,ac as i,a as h,N as p,T as I,aR as L,bf as D,ab as B,bK as E,bM as w,c0 as R,aO as X,aM as Y}from"./index.53af7074.js";import{Q as N,a as Q}from"./QItemSection.eab1c608.js";import{Q as O}from"./QList.f35af4b5.js";import{a as W,Q as Z}from"./QItemLabel.6c87fc9b.js";import{Q as tt}from"./QSlider.7ac99df7.js";import{a as et,Q as st}from"./QCard.eb5f99e8.js";import{u as at}from"./geolocation-info.9f3addb1.js";import{E as ot}from"./EmptyData.9cb3f6ab.js";import"./use-timeout.9d8f708d.js";import"./TouchPan.7c5636ff.js";import"./selection.4991ade7.js";import"./use-cache.b0833c75.js";import"./uid.42677368.js";import"./QResizeObserver.ebcab450.js";import"./rtl.b51694b1.js";import"./use-checkbox.9c0c879f.js";import"./format.2a3572e1.js";const it={position:{type:String,default:"bottom-right",validator:t=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(t)},offset:{type:Array,validator:t=>t.length===2},expand:Boolean};function lt(){const{props:t,proxy:{$q:s}}=j(),u=U(q,x);if(u===x)return console.error("QPageSticky needs to be child of QLayout"),x;const k=f(()=>{const r=t.position;return{top:r.indexOf("top")>-1,right:r.indexOf("right")>-1,bottom:r.indexOf("bottom")>-1,left:r.indexOf("left")>-1,vertical:r==="top"||r==="bottom",horizontal:r==="left"||r==="right"}}),e=f(()=>u.header.offset),n=f(()=>u.right.offset),y=f(()=>u.footer.offset),a=f(()=>u.left.offset),m=f(()=>{let r=0,b=0;const v=k.value,C=s.lang.rtl===!0?-1:1;v.top===!0&&e.value!==0?b=`${e.value}px`:v.bottom===!0&&y.value!==0&&(b=`${-y.value}px`),v.left===!0&&a.value!==0?r=`${C*a.value}px`:v.right===!0&&n.value!==0&&(r=`${-C*n.value}px`);const _={transform:`translate(${r}, ${b})`};return t.offset&&(_.margin=`${t.offset[1]}px ${t.offset[0]}px`),v.vertical===!0?(a.value!==0&&(_[s.lang.rtl===!0?"right":"left"]=`${a.value}px`),n.value!==0&&(_[s.lang.rtl===!0?"left":"right"]=`${n.value}px`)):v.horizontal===!0&&(e.value!==0&&(_.top=`${e.value}px`),y.value!==0&&(_.bottom=`${y.value}px`)),_}),$=f(()=>`q-page-sticky row flex-center fixed-${t.position} q-page-sticky--${t.expand===!0?"expand":"shrink"}`);function M(r){const b=H(r.default);return T("div",{class:$.value,style:m.value},t.expand===!0?b:[T("div",b)])}return{$layout:u,getStickyContent:M}}var nt=z({name:"QPageSticky",props:it,setup(t,{slots:s}){const{getStickyContent:u}=lt();return()=>u(s)}});const rt={name:"ManageShoppingListPage",components:{EmptyData:ot},data(){return{boughtItems:[],calculatedLocations:[],list:null,tab:"list",latlng:"",myCoordinates:{lat:0,lng:0},geolocationInfo:null,image:"Void.svg",title:"No location found in this radius",message:"Try to increase the radius"}},computed:{timeSpentShopping(){if(this.list.status==="completed"){const t=this.list.timeEnded-this.list.timeStarted;return new Date(t).toISOString().slice(11,19)}else return null},filteredLocationsInRadius(){return this.calculatedLocations.filter(t=>t.count!=0)}},async mounted(){this.geolocationInfo=at(),await this.fetchList(),A().$patch({title:this.list.name,showBackIcon:!0,backIconTo:"/shopping"});try{let s=await this.getPosition();this.myCoordinates.lat=s.coords.latitude,this.myCoordinates.lng=s.coords.longitude,this.latlng=this.myCoordinates.lat+","+this.myCoordinates.lng}catch(s){console.log(s)}await this.calculateLocations()},methods:{getPosition(){return new Promise((t,s)=>{navigator.geolocation.getCurrentPosition(t,s)})},async fetchList(){const t=await this.$api.get(`/shopping-lists/get-shopping-lists/${this.$route.params.shoppingListId}`);this.list=t.data.data.list},async changeListStatus(){try{const t={status:"active",timeStarted:Date.now()};(await this.$api.patch(`/shopping-lists/patch-shopping-list/${this.$route.params.shoppingListId}`,t)).data.status==="success"&&console.log("status changed successfully")}catch(t){console.log(t)}},async startShopping(){await this.changeListStatus(),await this.fetchList()},async endShopping(){try{const t={status:"completed",timeEnded:Date.now(),boughtItems:this.boughtItems};(await this.$api.patch(`/shopping-lists/end-shopping-list/${this.$route.params.shoppingListId}`,t)).data.status==="success"&&await this.fetchList()}catch(t){console.log(t)}},async reuseShoppingList(){try{const t=this.list.listItems.map(k=>k.item),s={name:new Date().toLocaleDateString("en-GB")+" "+new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),selectedProducts:t},u=await this.$api.post("/shopping-lists/create-shopping-list",s);u.data.status==="success"&&(await this.$router.push(`/shopping/${u.data.newListId}`),this.$router.go(0))}catch(t){console.log(t)}},async calculateLocations(){const t=await this.$api.get(`/locations/calculate-locations/${this.$route.params.shoppingListId}/within/${this.geolocationInfo.$state.radius}/center/${this.latlng}`);this.calculatedLocations=t.data.calculatedLocations},async sliderChanged(){await this.calculateLocations()},addKm(t){return t+"km"}}},ct=t=>(X("data-v-0e5ff5fa"),t=t(),Y(),t),ut={key:0},dt={class:"list-header"},pt={class:"list-header__count"},mt={key:0},gt={class:"list-header__status"},ht={class:"slider-box"},ft={key:0},yt=ct(()=>h("div",null,"Locations List",-1));function bt(t,s,u,k,e,n){const y=J("EmptyData");return e.list?(o(),g("div",ut,[e.list.isRecipe?d("",!0):(o(),c(K,{key:0,modelValue:e.tab,"onUpdate:modelValue":s[0]||(s[0]=a=>e.tab=a),dense:"",class:"text-grey","active-color":"teal","indicator-color":"teal",align:"justify","narrow-indicator":""},{default:l(()=>[i(V,{name:"list",label:"List"}),i(V,{name:"locations",label:"Locations"})]),_:1},8,["modelValue"])),i(S),i(F,{modelValue:e.tab,"onUpdate:modelValue":s[3]||(s[3]=a=>e.tab=a),animated:""},{default:l(()=>[i(P,{name:"list"},{default:l(()=>[h("div",dt,[h("div",pt,p(e.list.listItems.length)+" "+p(e.list.listItems.length<2?"item":"items"),1),n.timeSpentShopping?(o(),g("div",mt,p(n.timeSpentShopping),1)):d("",!0),h("div",gt,p(e.list.status),1)]),e.list.status!=="active"?(o(),c(O,{key:0,dense:"",bordered:"",padding:"",class:"rounded-borders list"},{default:l(()=>[(o(!0),g(I,null,L(e.list.listItems,(a,m)=>D((o(),c(N,{clickable:"",key:a._id},{default:l(()=>[i(Q,null,{default:l(()=>[h("div",null,[B(p(a.item)+" ",1),a.status==="bought"?(o(),c(E,{key:0,name:"done_outline"})):d("",!0),a.status==="not_bought"?(o(),c(E,{key:1,name:"close"})):d("",!0)]),m!==e.list.listItems.length-1?(o(),c(S,{key:0})):d("",!0)]),_:2},1024)]),_:2},1024)),[[R]])),128))]),_:1})):d("",!0),e.list.status==="active"?(o(),c(O,{key:1,dense:"",bordered:"",padding:"",class:"rounded-borders"},{default:l(()=>[(o(!0),g(I,null,L(e.list.listItems,a=>D((o(),c(N,{key:a._id,tag:"label"},{default:l(()=>[i(Q,{avatar:""},{default:l(()=>[i(W,{modelValue:e.boughtItems,"onUpdate:modelValue":s[1]||(s[1]=m=>e.boughtItems=m),val:a.item,color:"cyan-9"},null,8,["modelValue","val"])]),_:2},1024),i(Q,null,{default:l(()=>[i(Z,null,{default:l(()=>[B(p(a.item),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[R]])),128))]),_:1})):d("",!0),i(nt,{position:"bottom-right",class:"shopping-page-sticky"},{default:l(()=>[e.list.status==="pending"?(o(),c(w,{key:0,onClick:n.startShopping,fab:"",label:"go shopping",color:"cyan-9",class:"shopping-page-sticky-btn"},null,8,["onClick"])):d("",!0),e.list.status==="active"?(o(),c(w,{key:1,onClick:n.endShopping,fab:"",label:"end shopping",color:"cyan-9",class:"shopping-page-sticky-btn"},null,8,["onClick"])):d("",!0),e.list.status==="completed"?(o(),c(w,{key:2,onClick:n.reuseShoppingList,fab:"",icon:"refresh",label:"reuse list",color:"cyan-9",class:"shopping-page-sticky-btn"},null,8,["onClick"])):d("",!0)]),_:1})]),_:1}),i(P,{name:"locations"},{default:l(()=>[h("div",ht,[i(tt,{modelValue:e.geolocationInfo.radius,"onUpdate:modelValue":s[2]||(s[2]=a=>e.geolocationInfo.radius=a),markers:"","marker-labels":n.addKm,min:1,max:7,onChange:n.sliderChanged},null,8,["modelValue","marker-labels","onChange"])]),n.filteredLocationsInRadius.length?(o(),g("div",ft,[yt,(o(!0),g(I,null,L(n.filteredLocationsInRadius,a=>(o(),g("div",{key:a.coordinates},[a.count!==0?(o(),c(st,{key:0,flat:"",bordered:""},{default:l(()=>[i(et,null,{default:l(()=>[h("div",null,p(a.name),1),h("div",null,p(a.count)+"/"+p(e.list.listItems.length)+" items available ",1),i(S),(o(!0),g(I,null,L(a.availableItems,m=>(o(),g("div",{key:m._id},p(m.name)+" | "+p(m.price)+" lei ",1))),128)),i(S),h("div",null,"Total: "+p(a.total.toFixed(2))+" lei",1)]),_:2},1024)]),_:2},1024)):d("",!0)]))),128))])):(o(),c(y,{key:1,image:e.image,title:e.title,message:e.message},null,8,["image","title","message"]))]),_:1})]),_:1},8,["modelValue"])])):d("",!0)}var Mt=G(rt,[["render",bt],["__scopeId","data-v-0e5ff5fa"]]);export{Mt as default};
